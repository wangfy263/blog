---
title: 'gitflow工作流程使用经验'
date: 2018-05-15 21:13:21
tags:
---
背景：
---
公司一直使用svn做版本管控，项目一般只有两个分支，开发区和发布区，开发人员在开发过程中提交代码，然后在测试部署环境，测试通过后将代码同步至发布区，从发布区打包上线到生产环境；

前端项目现在多采用MVVM架构，每次上线需要全量打包，再加上多人协作的场景下，svn的管控模式已经难以满足复杂的场景；

先分析下问题所在：
---
1、开发人员多，每个人都在发布区提交代码，发布区的代码经常出现一更新就无法运行，只能先一一排错；同时测试环境沦为鸡肋，因为没有对应的稳定版本；
2、并行开发的版本多，同时有3个以上的需求在开发，但上线的时间并不一致，导致开发区的代码无法作为测试版本，只能由开发人员自己提交发布区，测试人员在发布区打包上线并测试；发布区沦为测试区；
3、前端项目无法增量上线，每次上线需要发布人全量打包，发布区版本由发布人员认为管控，上线日需要多次打包测试；

因此我们考虑引入gitLab作为版本管理工具，对开发上线流程进行管理；

Gitflow
---
Gitflow工作流通过为功能开发, 发布准备和维护分配独立的分支, 让发布迭代过程更流畅. 严格的分支模型也为大型项目提供了一些非常必要的结构. 
Gitflow工作流没有用超出功能分支工作流的概念和命令, 而是为不同的分支分配一个很明确的角色, 并定义分支之间如何和什么时候进行交互.
![avatar](gitflow工作流程使用经验/gitflow.png)

主要分支:
* Master(绿色): 永远处在 production-ready 状态；
* Develop(橙色): 最新的下次发布开发状态；

辅助分支:
* Feature(蓝色): 开发新功能都从 develop 分支新建出来，完成后合并（merge）回 develop分支
* Release(黄色): 准备要 release 的版本，只修 bugs。从 develop 分支出来，完成后 merge 回 master 和 develop
* Hotfix(灰色): 等不及 release 版本就必须马上修 master 赶上线的情况。会从 master 分支出来，完成后 merge 回 master 和 develop

结合实际的使用情况，我增加了一些规范：
1. master分支，需要时刻和生产环境保持一致，develop分支与测试环境保持一致，后期我计划加入持续集成上线的流程，这两个分支完成修改后将自动打包上传至对应环境，保持代码的一致性；
2. feature分支就是开发人员本地的分支，可以一个人一个分支，也可以多个人公用一个分支，建议按照功能点来新建分支，每个功能是一个分支，开发人员自测要在feature分支完成，自测通过后，merge到develop分支，提交由测试人员测试；
3. 测试人员在测试环境测试出bug，需要新建release分支，开发人员在release分支修复bug，而后merge回develop分支，测试人员再进行测试；
4. 测试人员测试通过后，将release分支merge到master分支，进行上线发布；
5. release分支在merge到master分支时，需要先在master分支打tag，作为历史版本；
6. 上线后，再次出现bug，需要开发人员在master分支基础上，新建hotfix分支，修复bug，修复后，merge到develop分支测试，测试通过后再merge到master分支，重新上线发布；
7. 如果上线失败（出现未能解决的bug，或者因为用户层面的原因）发布人员从master分支回退到上一个tag版本，然后执行上线回退；

